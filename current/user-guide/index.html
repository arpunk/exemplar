<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Exemplar User Guide</title>

    <link href="css/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="css/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="js/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages([null]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <div class="content"><span class="title">Exemplar User Guide</span></div>
      </span>
    </a>
    <div class="tocify-wrapper">
      <div class="content">
        <div class="logo">
        </div>
        <span class="title">Exemplar User Guide</span></div>
        <div class="lang-selector">
              <a href="#" data-language-name=""></a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://lfex.github.io/exemplar/current/api'>API Reference</a></li>
            <li><a href='https://github.com/lfex/exemplar/'>View the source</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p><a href="images/juggernaut-large.png"><img src="images/juggernaut-tiny.png" /></a></p>

<p><em>Markup Language Expressions for LFE: creating HTML with S-expressions on the Erlang VM.</em></p>

<h2 id="supported-tags">Supported Tags</h2>

<p><a href="images/HTML5_Logo_tiny.png"><img src="images/HTML5_Logo_tiny.png" /></a></p>

<p>Right now, only HTML5 is supported. Feel free to submit pull requests to support
older/different tags/elements.</p>

<p>The list of tags was obtained from <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5/HTML5_element_list">Mozilla&rsquo;s HTML 5 documentation</a></p>

<p>Note that XML namespacing hasn&rsquo;t been explored yet, but <em>should</em> be possible.</p>

<h2 id="current-status">Current Status</h2>

<p>As you can see in the example usage below, you can use exemplar to build HTML
strings using LFE S-expressions. However, do note that the project has <em>just</em>
started and there are lots of unexplored HTML edge-cases that simply won&rsquo;t work
right now.</p>

<p>If you come across anything, feel free to submit a bug in the github issue
tracker, or even send us a pull request :-)</p>

<h2 id="dependencies">Dependencies</h2>

<p>This project assumes that you have <a href="https://github.com/erlang/rebar3">rebar3</a>
installed somwhere in your <code class="prettyprint">$PATH</code>.</p>

<h2 id="installation">Installation</h2>

<blockquote>
<p>Just add it to your <code class="prettyprint">rebar.config</code> deps:</p>
</blockquote>
<pre class="highlight erlang"><code><span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="p">{</span><span class="n">exemplar</span><span class="p">,</span> <span class="s">".*"</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">"git@github.com:lfex/exemplar.git"</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">"x.y.z"</span><span class="p">}}</span>
  <span class="p">]}.</span>
</code></pre>

<blockquote>
<p>And then do the usual:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>rebar3 compile
</code></pre>

<p>Exemplar is like any other Erlang/LFE project &ndash; to use it in your project, simply add it to your <code class="prettyprint">rebar.config</code> file. Note that only rebar3 is supported now.</p>

<h2 id="the-name">The Name</h2>

<p>Naming and cache invalidation, right?</p>

<p>The first thought was to name the project ML-expr: ML for HTML, replacing the
&ldquo;s&rdquo; of &ldquo;s-expression&rdquo;. MLEXPR isn&rsquo;t all that pronouncable, so another &ldquo;e&rdquo; and
an &ldquo;a&rdquo; were added for &ldquo;exemplar&rdquo;. That&rsquo;s all there is to it.</p>

<p>Also: &ldquo;Do you know who I <em>am</em>?!&rdquo;</p>

<h2 id="conventions">Conventions</h2>

<p>We use styled call-outs to provide immediate visual cues about the nature of
the information being shared.</p>

<p>These are as follows:</p>

<aside class="info">
This style indicates useful information, background, or other insights.
</aside>

<aside class="success">
This style indicates a best practice, good usage, and other tips for success.
</aside>

<aside class="caution">
This style indicates one should use caution or that behaviour may not be as
expected
</aside>

<aside class="danger">
This style indicates information that could cause errors if ignored.
</aside>

          <h1 id="interactive-usage">Interactive Usage</h1>

<h2 id="html">HTML</h2>

<blockquote>
<p>Start the REPL:</p>
</blockquote>
<pre class="highlight shell"><code><span class="gp">$ </span>make shell
</code></pre>

<blockquote>
<p>Then, from a clone of exemplar:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (slurp "src/exemplar-html.lfe")
#(ok exemplar-html)
</code></pre>

<blockquote>
<p>Now create some tags:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (html (body (div (p "Here is some content")))))
</code></pre>

<p>Which will give the following output</p>
<pre class="highlight html"><code>"<span class="nt">&lt;html&gt;&lt;body&gt;&lt;div&gt;&lt;p&gt;</span>Here is some content<span class="nt">&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span>"
</code></pre>

<p>Generating HTML with Exemplar is very simple: all the HTML 5 tags have been defined to provide an HTML DSL in LFE. This lets you create HTML (and XML) in LFE without having to provide quoted HTML strings or binaries.</p>

<h2 id="custom-elements">Custom Elements</h2>

<blockquote>
<p>Define your own module and include the Exemplar XML macros:</p>
</blockquote>
<pre class="highlight plaintext"><code>(defmodule my-project
  (export all))

(include-lib "exemplar/include/xml-macros.lfe")

(defelem custom-elem)
</code></pre>

<blockquote>
<p>Then, you can <code class="prettyprint">make shell</code>, <code class="prettyprint">slurp</code> that file, and use your new element:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (slurp "src/my-project.lfe")
#(ok my-project)
&gt; (custom-elem (custom-elem "much wow"))
</code></pre>

<blockquote>
<p>Which will give the following output</p>
</blockquote>
<pre class="highlight html"><code>"<span class="nt">&lt;custom-elem&gt;&lt;custom-elem&gt;</span>much wow<span class="nt">&lt;/custom-elem&gt;&lt;/custom-elem&gt;</span>"
</code></pre>

<p>In addition to regular HTML 5, you can create your own custom elements. In your project that has exemplar set up as a dependency, create a module and <code class="prettyprint">include-lib</code> the XML macros file so that you can create your own elements.</p>

<h2 id="current-limitations">Current Limitations</h2>

<blockquote>
<p>We can see these three aritiies in action by slurping <code class="prettyprint">src/exemplar-html.lfe</code>
and calling these functions:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (slurp "src/exemplar-html.lfe")
#(ok exemplar-html)
&gt; (div)
"&lt;div /&gt;"
&gt; (div "some content")
"&lt;div&gt;some content&lt;/div&gt;"
&gt; (div '(class "some-css") "some content")
"&lt;div class=\"some-css\"&gt;some content&lt;/div&gt;"
</code></pre>

<blockquote>
<p>What this means is that (for now) you cannot do something like this:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (div (p "paragraph 1") (p "paragraph 2") (p "paragraph 3"))
exception error: #(unbound_func #(div 3))
</code></pre>

<blockquote>
<p>Since there is no <code class="prettyprint">#&#39;div/3</code>. Instead, you will have to do this:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (div '((p "paragraph 1") (p "paragraph 2") (p "paragraph 3")))
"&lt;div&gt;&lt;p&gt;paragraph 1&lt;/p&gt;&lt;p&gt;paragraph 2&lt;/p&gt;&lt;p&gt;paragraph 3&lt;/p&gt;&lt;/div&gt;"
</code></pre>

<blockquote>
<p>Another common use case:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (ul '((li "a") (li "b") (li "c")))
"&lt;ul&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;b&lt;/li&gt;&lt;li&gt;c&lt;/li&gt;&lt;/ul&gt;"
</code></pre>

<blockquote>
<p>Here&rsquo;s <code class="prettyprint">#&#39;div/1</code> with attributes and no content:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (div '(id "div-1" class "big"))
"&lt;div id=\"div-1\" class=\"big\" /&gt;"
</code></pre>

<blockquote>
<p>Here&rsquo;s an example using a variable in the attributes:</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; (set class "bigger")
"bigger"
&gt; (div `(id "div-1" class ,class))
"&lt;div id=\"div-1\" class=\"bigger\" /&gt;"
&gt; (div (list 'id "div-1" 'class class))
"&lt;div id=\"div-1\" class=\"bigger\" /&gt;"
</code></pre>

<p>Right now, the <code class="prettyprint">defelem</code> macro which generates all the HTML functions only
generates functions with three different arities. For instance,
<code class="prettyprint">include/html-macros.lfe</code> defines the <code class="prettyprint">div</code> element <code class="prettyprint">(defelem div)</code>.</p>

<p>The <code class="prettyprint">defelem</code> macro in <code class="prettyprint">include/xml-macros.lfe</code> generates three functions with
this definition:</p>

<ul>
<li><code class="prettyprint">div/0</code></li>
<li><code class="prettyprint">div/1</code></li>
<li><code class="prettyprint">div/2</code></li>
</ul>

<p>In order to nest S-expression tags, you will need to proivde the nested HTML-to-be to ensure one of the above arities is called on your element.</p>

<p>Note that the 1-arity generated functions have some smarts: in addition to being
able to handle lists of elements, they can also handle lists of attributes and
string content.</p>

<h1 id="exemplar-with-yaws">Exemplar with YAWS</h1>

<blockquote>
<p>A simple YAWS project project configuration:</p>
</blockquote>
<pre class="highlight plaintext"><code>logdir = logs
ebin_dir = deps/yaws/var/yaws/ebin
ebin_dir = ebin
log_resolve_hostname = false
fail_on_bind_err = true

&lt;server localhost&gt;
        port = 5099
        listen = 0.0.0.0
        appmods = &lt;/, my-project&gt;
        docroot = www
&lt;/server&gt;
</code></pre>

<blockquote>
<p>The <code class="prettyprint">my-project</code> module referenced in the <code class="prettyprint">appmods</code> directive:</p>
</blockquote>
<pre class="highlight plaintext"><code>(defmodule my-project
  (export all))

(include-lib "deps/exemplar/include/html-macros.lfe")

(defun out (arg-data)
  "This function is executed by YAWS. It is the YAWS entry point for our app."
  (let ((path-info (string:tokens
                      (parse-path arg-data)
                      "/")))
    (routes path-info arg-data)))

(defun routes
  "Routes for our app."
  ;; /content/:id
  (((list "content" item-id) arg-data)
   (content-api item-id arg-data))
  ;; potentially many other routes
  ...
  ;; When nothing matches, do this
  ((path method arg)
    (io:format
      "Unmatched route!~n Path-info: ~p~n arg-data: ~p~n~n"
      (list path arg))
    (make-error-response "Unmatched route.")))

(defun make-html-response (html)
  (tuple 'content
         "text/html"
         html))

(defun content-api (id request-data)
  ;; pull content from a data store
  (let ((fetched-title "Queried Title")
        (fetched-content "Some super-great queried lorem ipsum."))
    ({{PROJECT}}-util:make-200-result
      (html
        (list
            (head
              (title fetched-title))
            (body
              (main
                (div '(class "dynamic content")
                  (list
                    (h1 fetched-title)
                    (h2 (++ "Item " item-id))
                    (div (p fetched-content)))))))))))
</code></pre>

<p>If you are running a YAWS-based project, you can easily include exemplar in it.
Any function that is returning content to YAWS can simply use the exemplar HTML
macros.</p>

<p>Note that, due to the current limitation of the generated HTML element function
arities, we have to wrap sibling calls (e.g., <code class="prettyprint">(head ...) (body ...)</code> in a
<code class="prettyprint">list</code>.</p>

<p>Needless to say, one could also create custom templates via functions that
generate partial HTML and have parameters/variables for addition HTML to be
passed.</p>

<p>For more information on using LFE with YAWS, be sure to check out the
<a href="https://github.com/lfex/yaws-rest-starter">LFE REST example app</a>.</p>

          <h1 id="previous-versions">Previous Versions</h1>

<h2 id="user-guide">User Guide</h2>

<p>The User Guide is available for versions 0.3.1 and later:</p>

<ul>
<li><a href="../user-guide/">Current</a></li>
<li><a href="../user-guide/">0.3.2</a></li>
<li><a href="../../0.3.1/user-guide/">0.3.1</a></li>
</ul>

<h2 id="api-reference">API Reference</h2>

<p>The API Documentation is available for versions 0.3.1 and later:</p>

<ul>
<li><a href="../api/">Current</a></li>
<li><a href="../api/">0.3.2</a></li>
<li><a href="../../0.3.1/api/">0.3.1</a></li>
</ul>

          <h1 id="license">License</h1>

<p>Copyright &copy; 2014-2016 Duncan McGreggor</p>

<p>Distributed under the Apache License, Version 2.0.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name=""></a>
          </div>
      </div>
    </div>
  </body>
</html>
